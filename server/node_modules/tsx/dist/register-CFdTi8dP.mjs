var N=Object.defineProperty;var o=(e,s)=>N(e,"name",{value:s,configurable:!0});import{r as C}from"./get-pipe-path-BHW2eJdv.mjs";import h from"node:module";import p from"node:path";import{fileURLToPath as R}from"node:url";import{parseTsconfig as W,getTsconfig as D,createFilesMatcher as J,createPathsMatcher as Q}from"get-tsconfig";import k from"node:fs";import{p as z,a as B,b as G}from"./index-CEhzVOC2.mjs";import{p as M}from"./client-BQVF1NaW.mjs";const g=Object.create(null);g[".js"]=[".ts",".tsx",".js",".jsx"],g[".jsx"]=[".tsx",".ts",".jsx",".js"],g[".cjs"]=[".cts"],g[".mjs"]=[".mts"];const T=o(e=>{const[s,t]=e.split("?"),a=p.extname(s),i=g[a];if(i){const l=s.slice(0,-a.length);return i.map(r=>l+r+(t?`?${t}`:""))}},"resolveTsPath"),H=o(e=>{const s=e.indexOf(":");if(s!==-1)return e.slice(0,s)},"getScheme"),O=o(e=>e[0]==="."&&(e[1]==="/"||e[1]==="."||e[2]==="/"),"isRelativePath"),X=o(e=>O(e)||p.isAbsolute(e),"isUnixPath"),K=o(e=>{if(X(e))return!0;const s=H(e);return s&&s!=="node"},"requestAcceptsQuery"),U="file://",w=/\.([cm]?ts|[tj]sx)($|\?)/,V=/\.json($|\?)/,Y=/\/(?:$|\?)/,Z=/^(?:@[^/]+\/)?[^/]+$/;let S,j,_=!1;const L=o(e=>{let s=null;if(e){const t=p.resolve(e);s={path:t,config:W(t)}}else{try{s=D()}catch{}if(!s)return}S=J(s),j=Q(s),_=s?.config.compilerOptions?.allowJs??!1},"loadTsconfig"),E=o(e=>Array.from(e).length>0?`?${e.toString()}`:"","urlSearchParamsStringify"),q=`${p.sep}node_modules${p.sep}`,A=o(e=>{if(!e.startsWith("data:text/javascript,"))return e;const s=e.indexOf("?");if(s===-1)return e;const t=new URLSearchParams(e.slice(s+1));let a=t.get("filePath");if(a){const i=t.get("namespace");i&&(a+=`?namespace=${encodeURIComponent(i)}`),h._cache[a]=h._cache[e],delete h._cache[e],e=a}return e},"interopCjsExports"),$=o((e,s,t)=>{if(!(t?.filename&&w.test(t.filename))&&!_)return;const a=T(s);if(a)for(const i of a)try{return e(i)}catch(l){const{code:r}=l;if(r!=="MODULE_NOT_FOUND"&&r!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw l}},"resolveTsFilename"),ee=[".ts",".tsx",".jsx"],v=o((e,s)=>{for(const t of ee)try{return e(s+t)}catch{}},"tryExtensions"),se=o((e,s)=>(t,a,i,l)=>{const r=o(c=>e(c,a,i,l),"resolve");t=A(t);const[f,P]=t.split("?"),d=new URLSearchParams(P);if(a?.filename){const n=new URLSearchParams(a.filename.split("?")[1]).get("namespace");n&&d.append("namespace",n)}if((d.get("namespace")??void 0)!==s)return r(t);const m=E(d);if(t=f,t.startsWith(U)&&(t=R(t)),j&&!O(t)&&!a?.filename?.includes(q)){const c=j(t);for(const n of c){const x=$(r,n,a);if(x)return x+m;try{return r(n)+m}catch{const y=v(r,n)||v(r,p.resolve(n,"index"));if(y)return y+m}}}const u=$(r,t,a);if(u)return u+m;try{const c=r(t);return c+(p.isAbsolute(c)?m:"")}catch(c){const n=v(r,t)||v(r,p.resolve(t,"index"));if(n)return n+m;throw c}},"createResolveFilename"),te=o(e=>{if(!e.includes("import")&&!e.includes("export"))return!1;try{return z(e)[3]}catch{return!0}},"isESM"),ne=`
//# sourceMappingURL=data:application/json;base64,`,F=o(()=>process.sourceMapsEnabled??!0,"shouldApplySourceMap"),b=o(({code:e,map:s})=>e+ne+Buffer.from(JSON.stringify(s),"utf8").toString("base64"),"inlineSourceMap"),re=[".cts",".mts",".ts",".tsx",".jsx"],ae=[".js",".cjs",".mjs"],oe=o((e,s)=>{const t=Object.assign(Object.create(null),e),a=t[".js"],i=o((l,r)=>{const[f,P]=r.split("?");if((new URLSearchParams(P).get("namespace")??void 0)!==s)return a(l,f);M?.send&&M.send({type:"dependency",path:f});const m=re.some(n=>f.endsWith(n)),u=ae.some(n=>f.endsWith(n));if(!m&&!u)return a(l,f);let c=k.readFileSync(f,"utf8");if(f.endsWith(".cjs")){const n=B(r,c);n&&(c=F()?b(n):n.code)}else if(m||te(c)){const n=G(c,r,{tsconfigRaw:S?.(f)});c=F()?b(n):n.code}l._compile(c,f)},"transformer");return t[".js"]=i,[".ts",".tsx",".jsx",".mjs"].forEach(l=>{Object.defineProperty(t,l,{value:i,enumerable:!1})}),t},"createExtensions"),I=o((e,s)=>{if(!s)throw new Error("The current file path (__filename or import.meta.url) must be provided in the second argument of tsx.require()");return(typeof s=="string"&&s.startsWith("file://")||s instanceof URL)&&(s=R(s)),p.resolve(p.dirname(s),e)},"resolveContext"),ce=o(e=>{const{sourceMapsEnabled:s}=process,{_extensions:t,_resolveFilename:a}=h;L(process.env.TSX_TSCONFIG_PATH),process.setSourceMapsEnabled(!0);const i=se(a,e?.namespace);h._resolveFilename=i;const l=oe(h._extensions,e?.namespace);h._extensions=l;const r=o(()=>{s===!1&&process.setSourceMapsEnabled(!1),h._extensions=t,h._resolveFilename=a},"unregister");if(e?.namespace){const f=o((d,m)=>{const u=I(d,m),[c,n]=u.split("?"),x=new URLSearchParams(n);return e.namespace&&x.set("namespace",e.namespace),C(c+E(x))},"scopedRequire");r.require=f;const P=o((d,m,u)=>{const c=I(d,m),[n,x]=c.split("?"),y=new URLSearchParams(x);return e.namespace&&y.set("namespace",e.namespace),i(n+E(y),module,!1,u)},"scopedResolve");r.resolve=P,r.unregister=r}return r},"register");export{V as a,b,K as c,Y as d,Z as e,S as f,_ as g,T as h,A as i,U as j,j as k,L as l,ce as r,w as t};
