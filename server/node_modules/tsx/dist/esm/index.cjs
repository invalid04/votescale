"use strict";var F=Object.defineProperty;var u=(e,t)=>F(e,"name",{value:t,configurable:!0});var N=require("node:worker_threads"),d=require("../node-features-roYmp9jK.cjs"),S=require("../register-CfuJoh3S.cjs");require("../get-pipe-path-BoR10qr8.cjs"),require("node:module");var q=require("node:path"),w=require("node:url");require("get-tsconfig");var R=require("node:fs");require("esbuild"),require("node:crypto");var y=require("../index-C1vsvhPH.cjs"),T=require("../client-D6NvIMSC.cjs"),i=require("../register-BPRJR7M6.cjs");require("../require-BZ2WDgiR.cjs");var j=require("node:fs/promises");require("module"),require("../temporary-directory-B83uKxJF.cjs"),require("node:os"),require("node:net");const m={active:!0},O=u(async e=>{if(!e)throw new Error(`tsx must be loaded with --import instead of --loader
The --loader flag was deprecated in Node v20.6.0 and v18.19.0`);m.namespace=e.namespace,e.tsconfig!==!1&&i.loadTsconfig(e.tsconfig??process.env.TSX_TSCONFIG_PATH),e.port&&(m.port=e.port,e.port.on("message",t=>{t==="deactivate"&&(m.active=!1,e.port.postMessage({type:"deactivated"}))}))},"initialize"),v=u(()=>(i.loadTsconfig(process.env.TSX_TSCONFIG_PATH),"process.setSourceMapsEnabled(true);"),"globalPreload"),g=new Map,L=u(async e=>{if(g.has(e))return g.get(e);if(!await R.promises.access(e).then(()=>!0,()=>!1)){g.set(e,void 0);return}const n=await R.promises.readFile(e,"utf8");try{const o=JSON.parse(n);return g.set(e,o),o}catch{throw new Error(`Error parsing: ${e}`)}},"readPackageJson"),M=u(async e=>{let t=new URL("package.json",e);for(;!t.pathname.endsWith("/node_modules/package.json");){const n=w.fileURLToPath(t),o=await L(n);if(o)return o;const a=t;if(t=new URL("../package.json",t),t.pathname===a.pathname)break}},"findPackageJson"),D=u(async e=>(await M(e))?.type??"commonjs","getPackageType"),J=u(e=>{[e]=e.split("?");const t=q.extname(e);if(t===".json")return"json";if(t===".mjs"||t===".mts")return"module";if(t===".cjs"||t===".cts")return"commonjs"},"getFormatFromExtension"),$=u(e=>{const t=J(e);if(t)return t;if(i.tsExtensionsPattern.test(e))return D(e)},"getFormatFromFileUrl"),h="tsx-namespace=",l=u(e=>{const t=e.indexOf(h);if(t===-1)return;const n=e[t-1];if(n!=="?"&&n!=="&")return;const o=t+h.length,a=e.indexOf("&",o);return a===-1?e.slice(o):e.slice(o,a)},"getNamespace"),P=d.isFeatureSupported(d.importAttributes)?"importAttributes":"importAssertions",A=u(async(e,t,n)=>{if(!m.active)return n(e,t);const o=l(e);if(m.namespace&&m.namespace!==o)return n(e,t);if(m.port){const r=new URL(e);r.searchParams.delete("tsx-namespace"),m.port.postMessage({type:"load",url:r.toString()})}T.parent.send&&T.parent.send({type:"dependency",path:e}),i.isJsonPattern.test(e)&&(t[P]||(t[P]={}),t[P].type="json");const a=await n(e,t),p=e.startsWith("file://")?w.fileURLToPath(e):e;if(a.format==="commonjs"&&d.isFeatureSupported(d.esmLoadReadFile)&&a.responseURL?.startsWith("file:")&&!p.endsWith(".cjs")){const r=await y.transform(await j.readFile(new URL(e),"utf8"),p,{format:"cjs",platform:"node"}),c=new URLSearchParams({filePath:p});return o&&c.set("namespace",o),a.responseURL=`data:text/javascript,${encodeURIComponent(r.code)}?${c.toString()}`,a}if(!a.source)return a;const s=a.source.toString();if(a.format==="json"||i.tsExtensionsPattern.test(e)){const r=await y.transform(s,p,{tsconfigRaw:i.fileMatcher?.(p)});return{format:"module",source:i.inlineSourceMap(r)}}if(a.format==="module"){const r=y.transformDynamicImport(p,s);r&&(a.source=i.inlineSourceMap(r))}return a},"load"),_=u(async e=>(!e.format&&e.url.startsWith(i.fileUrlPrefix)&&(e.format=await $(e.url)),e),"resolveMissingFormat"),I=[".js",".json",".ts",".tsx",".jsx"],E=u(async(e,t,n)=>{const[o,a]=e.split("?");let p;for(const s of I)try{return await _(await n(o+s+(a?`?${a}`:""),t))}catch(r){if(p===void 0&&r instanceof Error){const{message:c}=r;r.message=r.message.replace(`${s}'`,"'"),r.stack=r.stack.replace(c,r.message),p=r}}throw p},"tryExtensions"),k=u(async(e,t,n)=>{const o=i.isDirectoryPattern.test(e),a=o?"index":"/index",[p,s]=e.split("?");try{return await E(p+a+(s?`?${s}`:""),t,n)}catch(r){if(!o)try{return await E(e,t,n)}catch{}const c=r,{message:f}=c;throw c.message=c.message.replace(`${a.replace("/",q.sep)}'`,"'"),c.stack=c.stack.replace(f,c.message),c}},"tryDirectory"),U=u(async(e,t,n,o)=>{if(!m.active)return n(e,t);const a=t.parentURL&&l(t.parentURL);if(i.requestAcceptsQuery(e)){let s=l(e);if(a&&!s&&(s=a,e+=`${e.includes("?")?"&":"?"}${h}${a}`),m.namespace&&m.namespace!==s)return n(e,t);if(i.isDirectoryPattern.test(e))return await k(e,t,n)}else if(i.tsconfigPathsMatcher&&!t.parentURL?.includes("/node_modules/")){const s=i.tsconfigPathsMatcher(e);for(const r of s)try{return await U(w.pathToFileURL(r).toString(),t,n)}catch{}}if(!i.isBarePackageName.test(e)&&(i.tsExtensionsPattern.test(t.parentURL)||i.allowJs)){const s=i.resolveTsPath(e);if(s)for(const r of s)try{return await _(await n(r,t))}catch(c){const{code:f}=c;if(f!=="ERR_MODULE_NOT_FOUND"&&f!=="ERR_PACKAGE_PATH_NOT_EXPORTED")throw c}}try{const s=await _(await n(e,t));if(i.requestAcceptsQuery(s.url)){const r=l(s.url);a&&!r&&(s.url+=`${s.url.includes("?")?"&":"?"}${h}${a}`)}return s}catch(s){if(s instanceof Error&&!o){const{code:r}=s;if(r==="ERR_UNSUPPORTED_DIR_IMPORT")try{return await k(e,t,n)}catch(c){if(c.code!=="ERR_PACKAGE_IMPORT_NOT_DEFINED")throw c}if(r==="ERR_MODULE_NOT_FOUND")try{return await E(e,t,n)}catch{}}throw s}},"resolve");d.isFeatureSupported(d.moduleRegister)&&N.isMainThread&&S.register(),exports.globalPreload=v,exports.initialize=O,exports.load=A,exports.resolve=U;
